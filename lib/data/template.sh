#!/bin/bash
#
# File: template.sh -> template variables
#
# Usage: source template.sh
#
#

## - start here

# app

: ${APP_IMAGE_TAG="$(get_app_image_tag "$DIB_APP_IMAGE_TAG")"}
: ${APP_KUBERNETES_NAMESPACE=${DIB_APP_KUBERNETES_NAMESPACE:-'default'}}
: ${APP_DB_CONNECTION_POOL=${DIB_APP_DB_CONNECTION_POOL:-'transaction'}}
: ${APP_KUBERNETES_CONTEXT=${DIB_APP_KUBERNETES_CONTEXT:-'microk8s'}}
: ${APP_NPM_RUN_COMMANDS=${DIB_APP_NPM_RUN_COMMANDS:-'build:docker'}}
: ${APP_BASE_HREF=${DIB_APP_BASE_HREF:-'/'}}
: ${APP_DEPLOY_URL=${DIB_APP_DEPLOY_URL:-'/'}}
: ${APP_BUILD_CONFIGURATION=${DIB_APP_BUILD_CONFIGURATION:-'dev-docker'}}
: ${APP_NPM_BUILD_COMMAND_DELIMITER=${DIB_APP_NPM_BUILD_COMMAND_DELIMITER:-','}}
: ${APP_REPO=${DIB_APP_REPO:-$DIB_APP_IMAGE_PLACEHOLDER}}
: ${APP_PORT=${DIB_APP_PORT:-'5000'}}

# dib

: ${APPS_CONTAINER_REGISTRY=${DIB_APPS_CONTAINER_REGISTRY:-'docker.io'}}

# docker

: ${DOCKER_LOGIN_USERNAME=${DIB_DOCKER_LOGIN_USERNAME:-'builder-script'}}
: ${DOCKER_LOGIN_PASSWORD=${DIB_DOCKER_LOGIN_PASSWORD:-"$DIB_APPS_SECRETS_DIR/${DOCKER_LOGIN_USERNAME}"}}
: ${DOCKER_FILE="$DIB_APP_BUILD_DEST/Dockerfile"}
: ${DOCKER_COMPOSE_FILE="$DIB_APP_BUILD_DEST/docker-compose.yml"}

# docker-compose

: ${DOCKER_COMPOSE_NETWORK_MODE=${DIB_DOCKER_COMPOSE_NETWORK_MODE:-'host'}}
: ${DOCKER_COMPOSE_DEPLOY_REPLICAS=${DIB_DOCKER_COMPOSE_DEPLOY_REPLICAS:-1}}
: ${DOCKER_COMPOSE_HEALTHCHECK_START_PERIOD=${DIB_DOCKER_COMPOSE_HEALTHCHECK_START_PERIOD:-'1m'}}
: ${DOCKER_COMPOSE_HEALTHCHECK_INTERVAL=${DIB_DOCKER_COMPOSE_HEALTHCHECK_INTERVAL:-'1m'}}
: ${DOCKER_COMPOSE_HEALTHCHECK_TIMEOUT=${DIB_DOCKER_COMPOSE_HEALTHCHECK_TIMEOUT:-'10s'}}
: ${DOCKER_COMPOSE_HEALTHCHECK_RETRIES=${DIB_DOCKER_COMPOSE_HEALTHCHECK_RETRIES:-3}}

# kompose

: ${KOMPOSE_IMAGE_PULL_SECRET=${DIB_KOMPOSE_IMAGE_PULL_SECRET:-'your-builder-script'}}
: ${KOMPOSE_IMAGE_PULL_POLICY=${DIB_KOMPOSE_IMAGE_PULL_POLICY:-'Always'}}
: ${KOMPOSE_SERVICE_TYPE=${DIB_KOMPOSE_SERVICE_TYPE:-'nodeport'}}
: ${KOMPOSE_SERVICE_EXPOSE=${DIB_KOMPOSE_SERVICE_EXPOSE:-'service-test.example.com'}}
: ${KOMPOSE_SERVICE_EXPOSE_TLS_SECRET=${DIB_KOMPOSE_SERVICE_EXPOSE_TLS_SECRET:-'example-service-staging'}}
: ${KOMPOSE_SERVICE_NODEPORT_PORT=${DIB_KOMPOSE_SERVICE_NODEPORT_PORT:-'5000'}}

# kubernetes

: ${KUBE_HOME=${KUBE_HOME:-${DIB_APPS_KUBERNETES_DIR}}}
: ${KUBECONFIGS=${DIB_KUBECONFIGS:-'microk8s-config'}}
: ${KUBERNETES_SERVICE_LABEL=${DIB_KUBERNETES_SERVICE_LABEL:-'io.kompose.service'}}

# spring

: ${SPRING_APPLICATION_PROPERTIES_DIR="$DIB_APP_BUILD_DEST/src/main/resources"}
: ${SPRING_APPLICATION_PROPERTIES="$DIB_APP_CONFIG_DIR/application.properties"}
: ${SPRING_APPLICATION_PROPERTIES_COPY="${SPRING_APPLICATION_PROPERTIES}.copy"}
: ${MAVEN_WRAPPER_PROPERTIES_SRC="${DIB_APPS_CONFIG_DIR}/${APP_FRAMEWORK}/maven-wrapper/"}
: ${MAVEN_WRAPPER_PROPERTIES_DEST="$DIB_APP_BUILD_DEST"}

## -- finish
